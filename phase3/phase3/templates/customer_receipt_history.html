{% extends "base.html" %}
{% load i18n %}
{% block content %}
<section class="card">
    <h2>Purchase History</h2>

    <!-- Date Filter -->
    <form method="GET" class="filter-form">
        <h3>{% trans "Filter by Date" %} </h3>
        {{ form.as_p }}
        <button type="submit">{% trans "Apply Filter" %} </button>
    </form>

    <h3>{% trans "Total Spent" %} : ${{ total_spent }}</h3>

    <br>

    <!-- Receipts Table -->
    <table>
        <tr>
            <th>{% trans "Date" %} </th>
            <th>{% trans "Total" %} </th>
            <th>{% trans "Points" %}  </th>
            <th></th>
        </tr>

        {% for r in receipts %}
        <tr>
            <td>{{ r.time }}</td>
            <td>${{ r.total_price }}</td>
            <td>{{ r.points_earned }}</td>
            <td><a href="{% url 'receipt_detail' r.id %}">View</a></td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">{% trans "No receipts found for this period." %}</td>
        </tr>
        {% endfor %}
    </table>

    <hr>
    <br><br>
    <!-- Search Purchases -->
    <h2>{% trans "Search Purchase History" %} </h2>

    <form method="GET" class="filter-form">
        {{ search_form.as_p }}
        <button type="submit">{% trans "Search" %} </button>
    </form>

    {% if info %}
        <h3>{% trans "Item" %} : {{ info.item_name }}</h3>
        <p><strong>{% trans "Purchased" %} :</strong> {{ info.count }} {% trans "Search" %}times</p>

        <table>
            <tr>
                <th>{% trans "Date" %} </th>
                <th>{% trans "Price" %} </th>
                <th>{% trans "Quantity" %} </th>
            </tr>

            {% for it in info.items %}
            <tr>
                <td>{{ it.receipt_id.time }}</td>
                <td>${{ it.product_id.price }}</td>
                <td>{{ it.product_quantity }}</td>
            </tr>
            {% endfor %}
        </table>
    {% endif %}

</section>
{% endblock %}
