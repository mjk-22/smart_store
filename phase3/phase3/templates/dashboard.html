{% extends "base.html" %}
{% load static %}

{% block content %}
<section class="card fridge-dashboard" data-latest-url="{% url 'fridge_latest' %}">
    <h2>Smart Store - Fridge Dashboard</h2>
    <p class="muted">Live temperature & humidity for all connected fridges.</p>

    <div class="gauge-grid">
        {% for f in fridges %}
        <article class="gauge-card" data-fridge-id="{{ f.id }}">
            <header class="gauge-header">
                <h3>{{ f.name }}</h3>
                <span class="pill" data-fan="{{ f.id }}">
                    Fan: {% if f.fan_on %}ON{% else %}OFF{% endif %} (auto)
                </span>
            </header>

            <div class="gauge-row">
                <!-- Temperature gauge -->
                <div class="gauge-panel">
                    <div class="gauge-value">
                        <span id="tempVal-{{ f.id }}">--</span> °C
                    </div>
                    <canvas id="tempGauge-{{ f.id }}"></canvas>
                    <div class="gauge-label">Temp</div>
                    <div class="gauge-scale">Scale: 0–40 °C</div>
                </div>

                <!-- Humidity gauge -->
                <div class="gauge-panel">
                    <div class="gauge-value">
                        <span id="humVal-{{ f.id }}">--</span> %
                    </div>
                    <canvas id="humGauge-{{ f.id }}"></canvas>
                    <div class="gauge-label">Humidity</div>
                    <div class="gauge-scale">Scale: 0–100 %</div>
                </div>
            </div>

            <footer class="gauge-footer">
                <form class="threshold-form" method="post"
                      action="{% url 'fridge_thresholds' f.id %}">
                    {% csrf_token %}
                    <label>
                        Temp threshold (°C)
                        <input type="number" step="0.1"
                               name="temp_threshold"
                               value="{{ f.temp_threshold }}">
                    </label>
                    <label>
                        Humidity threshold (%)
                        <input type="number" step="0.1"
                               name="humidity_threshold"
                               value="{{ f.humidity_threshold }}">
                    </label>
                    <button class="btn secondary small" type="submit">
                        Save thresholds
                    </button>
                </form>

                <div class="updated">
                    Last update:
                    <span data-updated="{{ f.id }}">{{ f.updated_at }}</span>
                </div>
            </footer>
        </article>
        {% empty %}
        <p>No fridges configured yet.</p>
        {% endfor %}
    </div>
</section>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/fridge_dashboard.js' %}"></script>
{% endblock %}
